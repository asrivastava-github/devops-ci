# devops-ci

## WSDL2

### Installation

- Install minikube
- Install docker
- Install helm


### Runtime setup

~/.bashrc
  alias k="minikube kubectl --"
  alias kubectl="minikube kubectl --"
  source <(k completion bash)

sudo dockerd

minikube start --driver=docker


### Clone repos

CI repo
  https://github.com/asrivastava-github/devops-ci.git

CD repo
  https://github.com/asrivastava-github/devops-cd.git


### Jenkins setup

  kubectl create namespace jenkins
  helm repo add jenkinsci https://charts.jenkins.io
  helm repo update
  helm search repo jenkinsci

cd devops-ci

#### Create persistant volume
  kubectl apply -f jenkins-ci/volume/jenkins-volume.yaml
  
  Minikube configured for hostPath sets the permissions on /data to the root account only. Once the volume is created you will need to manually change the permissions to allow the jenkins account to write its data.
    minikube ssh
    folder jenkins-volume will not be available under /data but you need create and make sure you correct the permission, as below
    sudo chown -R 1000:1000 /data/jenkins-volume


#### Create Jenkins service account to operate
  k apply -f jenkins-ci/service-account/jenkins-sa.yaml

  serviceaccount/jenkins create
  clusterrole.rbac.authorization.k8s.io/jenkins create
  clusterrolebinding.rbac.authorization.k8s.io/jenkins create


#### Define the Jenkins-values

  nodePort: Because we are using minikube we need to use NodePort as service type. Only cloud providers offer load balancers. We define port 32000 as port.

  storageClass:

  storageClass: jenkins-pv

  serviceAccount: the serviceAccount section of the jenkins-values.yaml file should look like this:

  serviceAccount:
    create: false
  # Service account name is autogenerated by default
  name: jenkins
  annotations: {}

#### Install via helm

  chart=jenkinsci/jenkins
  helm install jenkins -n jenkins -f jenkins-values.yaml $chart

  

  Get your 'admin' user password by running:

    jsonpath="{.data.jenkins-admin-password}"
    secret=$(kubectl get secret -n jenkins jenkins -o jsonpath=$jsonpath)
    echo $(echo $secret | base64 --decode)


    

  Get the Jenkins URL to visit by running these commands in the same shell:

    jsonpath="{.spec.ports[0].nodePort}"
    NODE_PORT=$(kubectl get -n jenkins -o jsonpath=$jsonpath services jenkins)
    jsonpath="{.items[0].status.addresses[0].address}"
    NODE_IP=$(kubectl get nodes -n jenkins -o jsonpath=$jsonpath)
    echo http://$NODE_IP:$NODE_PORT/login







